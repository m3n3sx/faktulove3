<!-- meta tags and other links -->
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrf_token }}">
  <!-- Bootstrap will be loaded locally via static files -->
  <title>FaktuLove.pl Test</title>
  {% load static %}
  {% load i18n %}

  <!-- Expose Django static URL to JavaScript -->
  <script>
    window.STATIC_URL = '{% get_static_prefix %}';
  </script>

  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"> <!- Dodaj CSS Toastify -->
  {% block extra_head %}{% endblock %}
  <link rel="icon" type="image/png" href="{% static 'assets/images/logo-icon.png' %}" sizes="16x16">
  <!-- remix icon font css  -->
  <link rel="stylesheet" href="{% static 'assets/css/remixicon.css' %}">
  <!-- BootStrap css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/bootstrap.min.css' %}">
  <!-- Data Table css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/dataTables.min.css' %}">
  <!-- Text Editor css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/editor-katex.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/css/lib/editor.atom-one-dark.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/css/lib/editor.quill.snow.css' %}">
  <!-- Date picker css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/flatpickr.min.css' %}">
  <!-- Calendar css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/full-calendar.css' %}">
  <!-- Vector Map css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/jquery-jvectormap-2.0.5.css' %}">
  <!-- Popup css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/magnific-popup.css' %}">
  <!-- Slick Slider css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/slick.css' %}">
  <!-- prism css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/prism.css' %}">
  <!-- file upload css -->
  <link rel="stylesheet" href="{% static 'assets/css/lib/file-upload.css' %}">
  
  <link rel="stylesheet" href="{% static 'assets/css/lib/audioplayer.css' %}">
  <!-- main css -->
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
  <!-- page enhancements css -->
  <link rel="stylesheet" href="{% static 'assets/css/page-enhancements.css' %}">
  <!-- error handling css -->
  <link rel="stylesheet" href="{% static 'assets/css/error-handling.css' %}">
</head>
  <body>
    <style>
      .notification-badge {
          position: relative;
          top: -10px;
          right: -10px;
          background: red;
          color: white;
          border-radius: 50%;
          padding: 3px 8px;
          font-size: 12px;
      }
  </style>
  <div id="new-notifications" class="notification-list"></div>
  <style>
  .notification-list {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: white;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
  </style>
  <div class="notification-bell" style="position: fixed; bottom: 20px; right: 20px;">
      <i class="fas fa-bell fa-2x"></i>
      <span id="notification-counter" class="notification-badge">0</span>
  </div>
  
{% include "partials/base/navi-sidebar.html" %}

<main class="dashboard-main">

{% include "partials/base/navi-header.html" %}

<div class="dashboard-main-body">
{% block content %}
{% endblock %}
</div>
  </div>

{% include "partials/base/footer.html" %}

</main>
  
  <!-- Error Handler - DISABLED due to infinite loop issues -->
  <!-- <script src="{% static 'assets/js/error-handler.js' %}"></script> -->
  
  <!-- Asset Monitor (load after error handler) -->
  <!-- Asset Monitor - DISABLED due to infinite loop issues -->
  <!-- <script src="{% static 'assets/js/asset-monitor.js' %}"></script> -->
  
  <!-- Asset Loading Monitor - DISABLED due to infinite loop issues -->
  <!-- <script src="{% static 'assets/js/asset-loading-monitor.js' %}"></script> -->
  
  <!-- Error Dashboard - DISABLED due to infinite loop issues -->
  <!-- <script src="{% static 'assets/js/error-dashboard.js' %}"></script> -->
  
  <!-- Bootstrap JavaScript -->
  <script src="{% static 'assets/js/lib/bootstrap.bundle.min.js' %}"></script>
  
  <!-- Dependency Manager - DISABLED due to infinite loop issues -->
  <!-- <script src="{% static 'assets/js/dependency-manager.js' %}"></script> -->
  
  <!-- CDN Fallback System - DISABLED due to infinite loop issues -->
  <!-- <script src="{% static 'assets/js/cdn-fallback.js' %}"></script> -->
  
  <!-- Core application scripts (load after dependencies are ready) -->
  <script>
    // Load CSRF utilities and OCR handler directly
    document.addEventListener('DOMContentLoaded', function() {
      // Load CSRF utilities
      const csrfScript = document.createElement('script');
      csrfScript.src = "{% static 'assets/js/csrf-utils.js' %}";
      document.head.appendChild(csrfScript);
      
      // Load OCR handler after CSRF utils
      csrfScript.onload = function() {
        const ocrScript = document.createElement('script');
        ocrScript.src = "{% static 'assets/js/ocr-handler.js' %}";
        document.head.appendChild(ocrScript);
      };
    });
  </script>
  
  <!-- Navigation Manager -->
  <script src="{% static 'assets/js/navigation-manager.js' %}"></script>
  
  <!-- Charts Manager -->
  <script src="{% static 'assets/js/charts-manager.js' %}"></script>
  
  <!-- Tables Manager -->
  <script src="{% static 'assets/js/tables-manager.js' %}"></script>
  
  <!-- Invoice Form Manager -->
  <script src="{% static 'assets/js/invoice-form-manager.js' %}"></script>
  
  <!-- Page Manager -->
  <script src="{% static 'assets/js/page-manager.js' %}"></script>
  
  <!-- Main application script (load after all dependencies) -->
  <script>
    // Load application scripts directly
    document.addEventListener('DOMContentLoaded', function() {
      // Load jQuery-dependent libraries
      const fileUploadScript = document.createElement('script');
      fileUploadScript.src = "{% static 'assets/js/lib/file-upload.js' %}";
      document.head.appendChild(fileUploadScript);
      
      const audioPlayerScript = document.createElement('script');
      audioPlayerScript.src = "{% static 'assets/js/lib/audioplayer.js' %}";
      document.head.appendChild(audioPlayerScript);
      
      // Load main app script
      const appScript = document.createElement('script');
      appScript.src = "{% static 'assets/js/app.js' %}";
      document.head.appendChild(appScript);
      
      // Load calendar script if needed
      if (document.querySelector('[data-calendar]')) {
        const calendarScript = document.createElement('script');
        calendarScript.src = "{% static 'assets/js/full-calendar-fv.js' %}";
        document.head.appendChild(calendarScript);
      }
    });
  </script>
  
  <!-- Toastify for notifications -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <!-- Enhanced DataTable initialization with error handling -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize DataTable if element exists
      const dataTableElement = document.getElementById('dataTable');
      if (dataTableElement && typeof $.fn.DataTable !== 'undefined') {
        try {
          let table = new DataTable('#dataTable');
          console.log('DataTable initialized successfully');
        } catch (error) {
          console.error('DataTable initialization failed:', error);
          // Fallback to basic table enhancement
          if (window.TablesManager) {
            TablesManager.initializeTable('#dataTable');
          }
        }
      }
    });
  </script>

</body>
</html>
